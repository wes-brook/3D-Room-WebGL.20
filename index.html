<!--
FileName:   index.html
Author:     Wesly Barayuga
Date:       10/30/2024
Purpose:    Define HTML code for a controllable 3D cube with Phong Reflection model
-->

<!DOCTYPE html>
<!-- Load image files -->
<img src="other/floor.jpg" id="floor" hidden>
<img src="other/wall.jpg" id="wall" hidden>
<img src="other/desk.jpg" id="desk" hidden>
<img src="other/monitor.jpg" id="monitor" hidden>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Room - WebGL 2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.4.0/gl-matrix.js"></script> <!-- Using a cloud stored file for gl-matrix.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"><!-- GitHub Icon -->
    <link rel="stylesheet" href="styles.css">
    <!-- Vertex Shader -->
    <script type="shader-vertex" id="vshader">
        attribute vec3 aPosition;
        attribute vec3 aNormal;
        attribute vec2 aTexCoord;

        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;
        uniform vec3 uLightDirection;

        varying vec3 vNormal;
        varying vec3 vFragPos;
        varying vec3 vLightDirection;
        varying vec3 vViewDirection;
        varying vec2 vTexCoord;

        void main() {
            vFragPos = vec3(uModelViewMatrix * vec4(aPosition, 1.0));
            vNormal = normalize(mat3(uModelViewMatrix) * aNormal);
            vLightDirection = normalize(uLightDirection);
            vViewDirection = normalize(-vFragPos);
            vTexCoord = aTexCoord;
            gl_Position = uProjectionMatrix * vec4(vFragPos, 1.0);
        }
    </script>
    <!-- Fragment Shader with custom Phong Reflection implementation -->
    <script type="shader-fragment" id="fshader">
        precision mediump float;

        varying vec3 vNormal;
        varying vec3 vFragPos;
        varying vec3 vLightDirection;
        varying vec3 vViewDirection;
        varying vec2 vTexCoord;
        
        uniform vec3 uLightColor;
        uniform vec3 uAmbientColor;
        uniform vec3 uLightPosition;
        
        uniform bool uUseDirectionalLight;
        uniform bool uUsePositionalLight;
        
        uniform sampler2D uTexture;
        
        void main() {
            vec3 ambient = uAmbientColor * 1.5;
            vec3 color = texture2D(uTexture, vTexCoord).rgb;
        
            vec3 diffuse = vec3(0.025);
            if (uUseDirectionalLight) {
                float diff = max(dot(vNormal, -vLightDirection), 0.0);
                diffuse += diff * uLightColor;
            }
        
            if (uUsePositionalLight) {
                float distance = length(uLightPosition - vFragPos);
                vec3 lightDir = normalize(uLightPosition - vFragPos);
                float diff = max(dot(vNormal, lightDir), 0.0);
                diffuse += diff * uLightColor * 3.0 / (distance * distance * 0.1); // Attenuation
            }
        
            vec3 reflectDir = reflect(-vLightDirection, vNormal);
            float spec = pow(max(dot(vViewDirection, reflectDir), 0.0), 32.0);
            vec3 specular = spec * uLightColor;
        
            gl_FragColor = vec4(color * (ambient + diffuse) + specular, 1.0);
        }
    </script>                                 
    <script type="shader-vertex" id="torch-vshader">
        attribute vec3 aPosition;
        attribute vec3 aNormal;
        
        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;
    
        varying vec3 vNormal;
        varying vec3 vFragPos;
    
        void main() {
            vFragPos = vec3(uModelViewMatrix * vec4(aPosition, 1.0));
            vNormal = normalize(mat3(uModelViewMatrix) * aNormal);
            gl_Position = uProjectionMatrix * vec4(vFragPos, 1.0);
        }
    </script>
    <script type="shader-fragment" id="torch-fshader">
        precision mediump float;

        varying vec3 vNormal;
        varying vec3 vFragPos;
        varying vec3 vLightDirection;
        varying vec3 vViewDirection;
        varying vec2 vTexCoord;

        uniform vec3 uLightColor;
        uniform vec3 uAmbientColor;
        uniform vec3 uLightPosition;

        uniform bool uUseDirectionalLight;
        uniform bool uUsePositionalLight;

        uniform sampler2D uTexture;

        void main() {
            vec3 ambient = uAmbientColor;
            vec3 color = texture2D(uTexture, vTexCoord).rgb;
        
            // Directional lighting
            vec3 diffuse = vec3(0.0);
            if (uUseDirectionalLight) {
                float diff = max(dot(vNormal, -vLightDirection), 0.0);
                diffuse += diff * uLightColor;
            }
        
            // Positional lighting (torch light effect)
            if (uUsePositionalLight) {
                float distance = length(uLightPosition - vFragPos);
                vec3 lightDir = normalize(uLightPosition - vFragPos);
                float diff = max(dot(vNormal, lightDir), 0.0);
                diffuse += diff * uLightColor * 3.0 / (distance * distance * 0.1); // Attenuation
            }
        
            // Reflection for specular highlights
            vec3 reflectDir = reflect(-vLightDirection, vNormal);
            float spec = pow(max(dot(vViewDirection, reflectDir), 0.0), 32.0);
            vec3 specular = spec * uLightColor;
        
            // Final color output with ambient, diffuse, and specular lighting
            gl_FragColor = vec4(color * (ambient + diffuse) + specular, 1.0);
        }
    </script>    
                                                    <!-- NOTE: Start of project workflow -->  
    <script src="view.js" defer></script>           <!-- Initialize `gl` and `canvas` -->
    <script src="Auxiliary.js"></script>            <!-- Load helper functions -->
    <script src="cube.js" defer></script>                 <!-- Load cube.js -->
    <script src="room.js" defer></script>                 <!-- Load room.js -->
    <script src="desk.js" defer></script>                 <!-- Load room.js -->
    <script src="desk2.js" defer></script>                 <!-- Load room.js -->
    <script src="monitor1.js" defer></script>                 <!-- Load room.js -->
    <script src="torch.js" defer></script>
    <script src="main.js" defer></script>           <!-- Load main.js -->
    <script src="controller.js" defer></script>     <!-- Load controller.js -->
</head>
<body>
    <div class="layout">
        <div id="canvas-holder">
            <canvas id="glCanvas" width="1400" height="800"></canvas> <!-- This component holds our render area for our cube-->
        </div>
        <div class="container"> <!-- This component holds header information and user notice -->
            <h1>3D Cubicle - WebGL 2.0</h1>
            <p>COMP 153 - Assignment 5 - 11/7/2024</p>
            <p>Developer: Wesly Barayuga</p>

            <div class="notice-box">
                <h2>User Notice</h2>
                <ul>
                    <li>Click anywhere in the viewport to begin</li>
                    <li>Move the camera position with <strong>ASWD</strong></li>
                    <li>Move the camera view with your <strong>mouse</strong></li>
                    <li>Exit the viewport by pressing the <strong>ESC</strong> key</li>
                    <li>The <strong>cube</strong> indicates the center at (0x, 0y, 0z)</li>
                    <li>Click the <strong>GitHub</strong> icon to view the repository</li>
                </ul>
            </div>
            <div class="notice-box">
                <h2>About</h2>
                <ul>
                    <li>This is a 3D recreation of my cubicle when I worked at <strong>Micron Technology</strong> - San Jose, CA</li>
                </ul>
            </div>
        </div>
        <div>
            <a href="https://github.com/wes-brook/3D-Room-WebGL.20" target="_blank" id="github-button" title="View GitHub Repository">
                <i class="fab fa-github"></i>
            </a>
        </div>
    </div>
</body>
</html>
